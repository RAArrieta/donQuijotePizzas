{% if request.session.carro.items %}
    <h3>Producto agregado:</h3>
    {% for key, value in request.session.carro.items %}
        {% if key != 'datos' %}
            {% if key == "empanadas" %}
                <p>Empanadas</p>
                <p>{{value.subtotal_emp}}</p>
            {% else %}
                <div class="widget">
                    {% if value.precio_doc != "None" %}
                        <div class="widget">
                            
                            <hr>
                            <p>{{value.nombre}}</p>
                            <a href="{% url 'carro:restar' value.producto_id %}">-</a>

                            <form method="post" action="{% url 'carro:actualizar_cantidad' value.producto_id %}">
                                {% csrf_token %}
                                <input type="hidden" name="producto_id" value="{{ value.producto_id }}">
                                <input type="number" name="nueva_cantidad" value="{{ value.cantidad|stringformat:"0.f" }}" min="1">
                            </form>

                            <a href="{% url 'carro:agregar' value.producto_id %}">+</a>
                            <p>{{value.subtotal}}</p>
                            <a href="{% url 'carro:eliminar' value.producto_id %}">x</a>
                        </div>
                    {% endif %} 
                </div>       
            {% endif %}

            
        {% endif %} 
    {% endfor %}

    {% for key, value in request.session.carro.items %}
        {% if key != 'datos' and key != 'empanadas'%}
            <div class="widget">
                {% if value.precio_doc == "None" and value.categoria != "Envío" %}
                    <div class="widget">
                        <p>{{value.nombre}}</p>
                        <a href="{% url 'carro:restar' value.producto_id %}">-</a>

                        <form method="post" action="{% url 'carro:actualizar_cantidad' value.producto_id %}">
                            {% csrf_token %}
                            <input type="hidden" name="producto_id" value="{{ value.producto_id }}">
                            {% if value.precio_media != "None" and value.precio_doc == "None" %}
                                <input type="number" name="nueva_cantidad" value="{{ value.cantidad|stringformat:"0.1f" }}" min="0.5" step="0.5">
                            {% else %}
                                <input type="number" name="nueva_cantidad" value="{{ value.cantidad|stringformat:"0.f" }}" min="1">
                            {% endif %}
                        </form>

                        <a href="{% url 'carro:agregar' value.producto_id %}">+</a>
                        <p>{{value.subtotal}}</p>
                        <a href="{% url 'carro:eliminar' value.producto_id %}">x</a>
                    </div>
                {% endif %}   
            </div>
        {% endif %}    
    {% endfor %}

    {% for key, value in request.session.carro.items %}
        {% if value.categoria == "Envío" %}
        <div class="widget">
            <p>{{value.nombre}}</p>
            <form method="post" action="{% url 'carro:actualizar_cantidad' value.producto_id %}">
                {% csrf_token %}
                {% if value.subtotal > 0 %}
                    <p>{{value.subtotal}}</p>
                {% endif %}
                
            </form>
        </div>
            
        {% endif %} 
    {% endfor %}
    
{% else %}    
    <h2>No hay productos cargados</h2>
{% endif %}
